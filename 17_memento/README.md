# memento

## 定义

在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态。这样以后就可将该对象恢复到原先保存的状态

![](https://cdn.jsdelivr.net/gh/zhecks/static_resources/images/202308181621444.png)

## 窄接口和宽接口

在备忘录模式中，为了控制堆备忘录对象的访问，出现了窄接口和宽接口的概念

* 窄接口：管理者指只能看到备忘录的窄接口，窄接口的实现中通常没有任何的方法，只是一个类似标识。窄接口使得管理者只能将备忘录传递给其他对象
* 宽接口：原发器能够看到一个宽接口，允许它访问所需的所有数据，来返回到先前的状态。理想状况是：只允许生成备忘录的原发器来访问该备忘录的内部状态，通常实现称为原发器内的一个私有内部类

ps：不让备忘录管理员访问数据只有可能备忘录的托管和程序不在一台机器上，为了安全考虑，避免备忘录管理员作恶，否则窄接口和宽接口的意义不大。但通过这种窄接口和宽接口实际不能解决这种问题，一种合理的做法应该是对备忘录进行加密，只有原发器才能解开

## 优缺点

备忘录模式有以下优点

* 更好的封装性

备忘录模式通过使用备忘录对象，来封装原发器对象的内部状态，虽然这个对象是保存在原发器对象的外部，但是由于备忘录对象的窄接口并不提供任何方法。这样有效地保证了对原发器对象内部状态的封装，不把原发器对象的内部实现细节暴露给外部

ps：防了等于没防

* 简化了原发器

备忘录模式中，备忘录对象被保存到原发器对象之外，让客户来管理他们请求的状态，从而让原发器对象得到简化

* 窄接口和宽接口

备忘录模式，通过引入窄接口和宽接口，使得不同的地方，对备忘录对象的访问是不一样的。窄接口保证了只有原发器蔡可以访问备忘录对象的状态。

ps：窄接口和宽接口什么都防不了，只能假装防自己

## 思考

1. 备忘录模式的本质

备忘录模式的本质：保存和恢复内部状态

2. 何时选用备忘录模式

* 如果必须保存一个对象在某一个时刻的全部或者部分状态，方便在以后需要的时候，可以把该对象恢复到先前的状态，可以使用备忘录模式。使用备忘录对象来封装和保存需要保存的内部状态，然后把备忘录对象保存到管理者对象中，在需要的时候，再从管理者对象中获取备忘录对象，来恢复对象的状态
* 如果需要保存一个对象的内部状态，但是如果用接口来让其他对象直接得到这些需要保存的状态，将会暴露对象的实现细节并破坏对象的封装性，这时可以使用备忘录模式，把备忘录对象实现成为原发器对象的内部类，而且还是私有的，从而保证只有缘法器对象才能访问该备忘录对象。这样即保存了需要保存的状态，又不会暴露原发器对象的内部实现细节